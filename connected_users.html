
<!DOCTYPE html>
<html>
<head>
    <title>Interactive Transaction Network</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .node {
            cursor: move;
            stroke: #fff;
            stroke-width: 2px;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            marker-end: url(#end);
        }
        .node-label {
            pointer-events: none;
            text-anchor: middle;
            font-size: 12px;
            font-weight: bold;
            fill: white;
        }
        .edge-label {
            pointer-events: none;
            text-anchor: middle;
            font-size: 12px;
            font-weight: bold;
            fill: red;
        }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <h2>OatFi Connected Partners Graph</h2>
    <svg width="1200" height="800"></svg>
    <div class="tooltip" style="opacity: 0;"></div>

    <script>
        const svg = d3.select("svg");
        const width = +svg.attr("width");
        const height = +svg.attr("height");

        // Add arrow markers for both directions
        const defs = svg.append("defs");
        
        defs.append("marker")
            .attr("id", "end")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 25)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#999");
            
        defs.append("marker")
            .attr("id", "start")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", -15)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M10,-5L0,0L10,5")
            .attr("fill", "#999");

        // Data
        const nodes = [{"id": "Relay Financial Technologies, Inc", "label": "Relay Financial...", "color": "#ff6b6b", "size": 54.4954128440367, "x": 725.5286920923055, "y": 482.63907530977787, "tooltip": "<b>Relay Financial Technologies, Inc</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 98<br>\u2022 Org Inflow: 13<br>\u2022 Org Outflow: 85<br>\u2022 Org Net: -72<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $2,624,098.95<br>\u2022 Dollar Inflow: $1,854,082.79<br>\u2022 Dollar Outflow: $770,016.16<br>\u2022 Dollar Net: $+1,084,066.63<br><br><b>Visual Info:</b><br>\u2022 Node Size: 54.5px radius<br>\u2022 Represents: 98 total organizations", "org_total": 98}, {"id": "Melio", "label": "Melio", "color": "#785cb8", "size": 60.0, "x": 919.6903819202225, "y": 395.2127401544754, "tooltip": "<b>Melio</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 110<br>\u2022 Org Inflow: 110<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +110<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $2,473,653.67<br>\u2022 Dollar Inflow: $727,927.61<br>\u2022 Dollar Outflow: $1,745,726.06<br>\u2022 Dollar Net: $-1,017,798.45<br><br><b>Visual Info:</b><br>\u2022 Node Size: 60.0px radius<br>\u2022 Represents: 110 total organizations", "org_total": 110}, {"id": "Koverly Inc.", "label": "Koverly Inc.", "color": "#45b7d1", "size": 41.65137614678899, "x": 601.825578889261, "y": 393.2267748813859, "tooltip": "<b>Koverly Inc.</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 70<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 70<br>\u2022 Org Net: -70<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $4,032,284.69<br>\u2022 Dollar Inflow: $2,251,043.15<br>\u2022 Dollar Outflow: $1,781,241.54<br>\u2022 Dollar Net: $+469,801.61<br><br><b>Visual Info:</b><br>\u2022 Node Size: 41.7px radius<br>\u2022 Represents: 70 total organizations", "org_total": 70}, {"id": "Cargosprint", "label": "Cargosprint", "color": "#54a0ff", "size": 18.71559633027523, "x": 200.0, "y": 463.30865184497463, "tooltip": "<b>Cargosprint</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 20<br>\u2022 Org Inflow: 20<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +20<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $1,659,717.01<br>\u2022 Dollar Inflow: $853,231.28<br>\u2022 Dollar Outflow: $806,485.73<br>\u2022 Dollar Net: $+46,745.55<br><br><b>Visual Info:</b><br>\u2022 Node Size: 18.7px radius<br>\u2022 Represents: 20 total organizations", "org_total": 20}, {"id": "HouseCall Pro", "label": "HouseCall Pro", "color": "#a55eea", "size": 20.091743119266056, "x": 860.9145613458438, "y": 510.35943967686296, "tooltip": "<b>HouseCall Pro</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 23<br>\u2022 Org Inflow: 23<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +23<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $1,626,366.81<br>\u2022 Dollar Inflow: $142,164.01<br>\u2022 Dollar Outflow: $1,484,202.80<br>\u2022 Dollar Net: $-1,342,038.79<br><br><b>Visual Info:</b><br>\u2022 Node Size: 20.1px radius<br>\u2022 Represents: 23 total organizations", "org_total": 23}, {"id": "Avalara Inc", "label": "Avalara Inc", "color": "#4ecdc4", "size": 32.477064220183486, "x": 561.8565657416243, "y": 596.0985595244805, "tooltip": "<b>Avalara Inc</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 50<br>\u2022 Org Inflow: 35<br>\u2022 Org Outflow: 15<br>\u2022 Org Net: +20<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $4,793,146.97<br>\u2022 Dollar Inflow: $4,672,673.22<br>\u2022 Dollar Outflow: $120,473.75<br>\u2022 Dollar Net: $+4,552,199.47<br><br><b>Visual Info:</b><br>\u2022 Node Size: 32.5px radius<br>\u2022 Represents: 50 total organizations", "org_total": 50}, {"id": "Cledara Limited", "label": "Cledara Limited", "color": "#96ceb4", "size": 16.422018348623855, "x": 787.8569282029725, "y": 369.68424173574545, "tooltip": "<b>Cledara Limited</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 15<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 15<br>\u2022 Org Net: -15<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $616,433.76<br>\u2022 Dollar Inflow: $100,479.25<br>\u2022 Dollar Outflow: $515,954.51<br>\u2022 Dollar Net: $-415,475.26<br><br><b>Visual Info:</b><br>\u2022 Node Size: 16.4px radius<br>\u2022 Represents: 15 total organizations", "org_total": 15}, {"id": "Order", "label": "Order", "color": "#95a5a6", "size": 14.128440366972477, "x": 440.77368652120583, "y": 275.7307703750814, "tooltip": "<b>Order</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 10<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 10<br>\u2022 Org Net: -10<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $3,280,218.00<br>\u2022 Dollar Inflow: $0.00<br>\u2022 Dollar Outflow: $3,280,218.00<br>\u2022 Dollar Net: $-3,280,218.00<br><br><b>Visual Info:</b><br>\u2022 Node Size: 14.1px radius<br>\u2022 Represents: 10 total organizations", "org_total": 10}, {"id": "Flychain", "label": "Flychain", "color": "#feca57", "size": 13.211009174311927, "x": 377.9492834085725, "y": 562.7400887112136, "tooltip": "<b>Flychain</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 8<br>\u2022 Org Inflow: 1<br>\u2022 Org Outflow: 7<br>\u2022 Org Net: -6<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $49,319.32<br>\u2022 Dollar Inflow: $101.32<br>\u2022 Dollar Outflow: $49,218.00<br>\u2022 Dollar Net: $-49,116.68<br><br><b>Visual Info:</b><br>\u2022 Node Size: 13.2px radius<br>\u2022 Represents: 8 total organizations", "org_total": 8}, {"id": "WebCargo", "label": "WebCargo", "color": "#95a5a6", "size": 10.917431192660551, "x": 573.7508219823146, "y": 119.52598581322212, "tooltip": "<b>WebCargo</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 3<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 3<br>\u2022 Org Net: -3<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $43,725.46<br>\u2022 Dollar Inflow: $3,518.76<br>\u2022 Dollar Outflow: $40,206.70<br>\u2022 Dollar Net: $-36,687.94<br><br><b>Visual Info:</b><br>\u2022 Node Size: 10.9px radius<br>\u2022 Represents: 3 total organizations", "org_total": 3}, {"id": "BRKR.IO Inc.", "label": "BRKR.IO Inc.", "color": "#00d2d3", "size": 11.376146788990827, "x": 772.8349116140981, "y": 141.37876284922993, "tooltip": "<b>BRKR.IO Inc.</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 4<br>\u2022 Org Inflow: 3<br>\u2022 Org Outflow: 1<br>\u2022 Org Net: +2<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $12,186.17<br>\u2022 Dollar Inflow: $400.00<br>\u2022 Dollar Outflow: $11,786.17<br>\u2022 Dollar Net: $-11,386.17<br><br><b>Visual Info:</b><br>\u2022 Node Size: 11.4px radius<br>\u2022 Represents: 4 total organizations", "org_total": 4}, {"id": "Upflow", "label": "Upflow", "color": "#ff6348", "size": 10.458715596330276, "x": 240.06745359983552, "y": 297.06244494780253, "tooltip": "<b>Upflow</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 2<br>\u2022 Org Inflow: 1<br>\u2022 Org Outflow: 1<br>\u2022 Org Net: +0<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $584.03<br>\u2022 Dollar Inflow: $37.37<br>\u2022 Dollar Outflow: $546.66<br>\u2022 Dollar Net: $-509.29<br><br><b>Visual Info:</b><br>\u2022 Node Size: 10.5px radius<br>\u2022 Represents: 2 total organizations", "org_total": 2}, {"id": "Hostfi Inc. DBA Accountable", "label": "Hostfi Inc. DBA...", "color": "#ff9ff3", "size": 10.0, "x": 736.9511346817438, "y": 593.0324641757478, "tooltip": "<b>Hostfi Inc. DBA Accountable</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 1<br>\u2022 Org Inflow: 1<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +1<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $417.32<br>\u2022 Dollar Inflow: $417.32<br>\u2022 Dollar Outflow: $0.00<br>\u2022 Dollar Net: $+417.32<br><br><b>Visual Info:</b><br>\u2022 Node Size: 10.0px radius<br>\u2022 Represents: 1 total organizations", "org_total": 1}];
        const links = [{"source": "Relay Financial Technologies, Inc", "target": "Melio", "orgs": 50}, {"source": "Relay Financial Technologies, Inc", "target": "HouseCall Pro", "orgs": 18}, {"source": "Relay Financial Technologies, Inc", "target": "Avalara Inc", "orgs": 13}, {"source": "Relay Financial Technologies, Inc", "target": "Upflow", "orgs": 1}, {"source": "Relay Financial Technologies, Inc", "target": "Hostfi Inc. DBA Accountable", "orgs": 1}, {"source": "Relay Financial Technologies, Inc", "target": "BRKR.IO Inc.", "orgs": 1}, {"source": "Relay Financial Technologies, Inc", "target": "Flychain", "orgs": 1}, {"source": "Koverly Inc.", "target": "Melio", "orgs": 43}, {"source": "Koverly Inc.", "target": "Cargosprint", "orgs": 19}, {"source": "Koverly Inc.", "target": "Avalara Inc", "orgs": 5}, {"source": "Koverly Inc.", "target": "Relay Financial Technologies, Inc", "orgs": 3}, {"source": "Avalara Inc", "target": "Melio", "orgs": 12}, {"source": "Avalara Inc", "target": "HouseCall Pro", "orgs": 2}, {"source": "Avalara Inc", "target": "Relay Financial Technologies, Inc", "orgs": 1}, {"source": "Cledara Limited", "target": "Avalara Inc", "orgs": 10}, {"source": "Cledara Limited", "target": "Relay Financial Technologies, Inc", "orgs": 3}, {"source": "Cledara Limited", "target": "Melio", "orgs": 2}, {"source": "Order", "target": "Avalara Inc", "orgs": 5}, {"source": "Order", "target": "Relay Financial Technologies, Inc", "orgs": 2}, {"source": "Order", "target": "HouseCall Pro", "orgs": 2}, {"source": "Order", "target": "Melio", "orgs": 1}, {"source": "Flychain", "target": "Relay Financial Technologies, Inc", "orgs": 4}, {"source": "Flychain", "target": "Melio", "orgs": 2}, {"source": "Flychain", "target": "HouseCall Pro", "orgs": 1}, {"source": "WebCargo", "target": "BRKR.IO Inc.", "orgs": 2}, {"source": "WebCargo", "target": "Cargosprint", "orgs": 1}, {"source": "BRKR.IO Inc.", "target": "Avalara Inc", "orgs": 1}, {"source": "Upflow", "target": "Avalara Inc", "orgs": 1}];

        // Create force simulation
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(150))
            .force("charge", d3.forceManyBody().strength(-1000))
            .force("center", d3.forceCenter(width / 2, height / 2));

        // Create links with proper bidirectional handling
        const link = svg.append("g")
            .selectAll("line")
            .data(links)
            .enter().append("line")
            .attr("class", "link")
            .attr("stroke-width", d => Math.max(2, d.orgs / 50))
            .attr("marker-end", "url(#end)");

        // Create edge labels with proper positioning for bidirectional links
        const edgeLabels = svg.append("g")
            .selectAll("text")
            .data(links)
            .enter().append("text")
            .attr("class", "edge-label")
            .style("fill", "red")
            .style("font-weight", "bold")
            .style("font-size", "10px")
            .text(d => d.orgs);

        // Create nodes
        const node = svg.append("g")
            .selectAll("circle")
            .data(nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", d => d.size)
            .attr("fill", d => d.color)
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // Create node labels
        const nodeLabels = svg.append("g")
            .selectAll("text")
            .data(nodes)
            .enter().append("text")
            .attr("class", "node-label")
            .style("fill", "black")
            .style("font-weight", "bold")
            .text(d => d.label);

        // Tooltip
        const tooltip = d3.select(".tooltip");

        // Add hover events
        node.on("mouseover", function(event, d) {
            tooltip.transition().duration(200).style("opacity", .9);
            tooltip.html(d.tooltip)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", function(d) {
            tooltip.transition().duration(500).style("opacity", 0);
        });

        // Update positions on tick
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            edgeLabels
                .attr("x", d => {
                    const midX = (d.source.x + d.target.x) / 2;
                    if (d.bidirectional) {
                        const offset = d.direction === 'forward' ? 10 : -10;
                        const angle = Math.atan2(d.target.y - d.source.y, d.target.x - d.source.x);
                        return midX + offset * Math.cos(angle + Math.PI/2);
                    }
                    return midX;
                })
                .attr("y", d => {
                    const midY = (d.source.y + d.target.y) / 2;
                    if (d.bidirectional) {
                        const offset = d.direction === 'forward' ? 10 : -10;
                        const angle = Math.atan2(d.target.y - d.source.y, d.target.x - d.source.x);
                        return midY + offset * Math.sin(angle + Math.PI/2);
                    }
                    return midY;
                });

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);

            nodeLabels
                .attr("x", d => d.x)
                .attr("y", d => d.y + 5);
        });

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    </script>
</body>
</html>
