
<!DOCTYPE html>
<html>
<head>
    <title>Interactive Transaction Network</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .node {
            cursor: move;
            stroke: #fff;
            stroke-width: 2px;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            marker-end: url(#end);
        }
        .node-label {
            pointer-events: none;
            text-anchor: middle;
            font-size: 12px;
            font-weight: bold;
            fill: white;
        }
        .edge-label {
            pointer-events: none;
            text-anchor: middle;
            font-size: 12px;
            font-weight: bold;
            fill: red;
        }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <h2>OatFi Connected Partners Graph</h2>
    <svg width="1200" height="800"></svg>
    <div class="tooltip" style="opacity: 0;"></div>

    <script>
        const svg = d3.select("svg");
        const width = +svg.attr("width");
        const height = +svg.attr("height");

        // Add arrow markers for both directions
        const defs = svg.append("defs");
        
        defs.append("marker")
            .attr("id", "end")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 25)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#999");
            
        defs.append("marker")
            .attr("id", "start")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", -15)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M10,-5L0,0L10,5")
            .attr("fill", "#999");

        // Data
        const nodes = [{"id": "Koverly Inc.", "label": "Koverly Inc.", "color": "#45b7d1", "size": 40.0, "x": 773.1486065511995, "y": 610.1722660410528, "tooltip": "<b>Koverly Inc.</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 25<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 25<br>\u2022 Org Net: -25<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $1,995,453.38<br>\u2022 Dollar Inflow: $806,485.73<br>\u2022 Dollar Outflow: $1,188,967.65<br>\u2022 Dollar Net: $-382,481.92<br><br><b>Visual Info:</b><br>\u2022 Node Size: 40.0px radius<br>\u2022 Represents: 25 total organizations", "org_total": 25}, {"id": "Cargosprint", "label": "Cargosprint", "color": "#54a0ff", "size": 30.0, "x": 965.8460441190413, "y": 439.0248348499764, "tooltip": "<b>Cargosprint</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 17<br>\u2022 Org Inflow: 17<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +17<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $1,593,103.68<br>\u2022 Dollar Inflow: $786,617.95<br>\u2022 Dollar Outflow: $806,485.73<br>\u2022 Dollar Net: $-19,867.78<br><br><b>Visual Info:</b><br>\u2022 Node Size: 30.0px radius<br>\u2022 Represents: 17 total organizations", "org_total": 17}, {"id": "Relay Financial Technologies, Inc", "label": "Relay Financial...", "color": "#ff6b6b", "size": 60.0, "x": 498.57695822772416, "y": 360.42354527347965, "tooltip": "<b>Relay Financial Technologies, Inc</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 41<br>\u2022 Org Inflow: 13<br>\u2022 Org Outflow: 28<br>\u2022 Org Net: -15<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $1,882,322.16<br>\u2022 Dollar Inflow: $1,226,841.56<br>\u2022 Dollar Outflow: $655,480.60<br>\u2022 Dollar Net: $+571,360.96<br><br><b>Visual Info:</b><br>\u2022 Node Size: 60.0px radius<br>\u2022 Represents: 41 total organizations", "org_total": 41}, {"id": "HouseCall Pro", "label": "HouseCall Pro", "color": "#a55eea", "size": 31.25, "x": 236.1754244094924, "y": 543.5336010361066, "tooltip": "<b>HouseCall Pro</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 18<br>\u2022 Org Inflow: 18<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +18<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $1,252,098.15<br>\u2022 Dollar Inflow: $105,749.12<br>\u2022 Dollar Outflow: $1,146,349.03<br>\u2022 Dollar Net: $-1,040,599.91<br><br><b>Visual Info:</b><br>\u2022 Node Size: 31.2px radius<br>\u2022 Represents: 18 total organizations", "org_total": 18}, {"id": "Avalara Inc", "label": "Avalara Inc", "color": "#4ecdc4", "size": 55.0, "x": 851.938546008358, "y": 580.0045875471828, "tooltip": "<b>Avalara Inc</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 37<br>\u2022 Org Inflow: 34<br>\u2022 Org Outflow: 3<br>\u2022 Org Net: +31<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $4,720,356.08<br>\u2022 Dollar Inflow: $4,649,895.08<br>\u2022 Dollar Outflow: $70,461.00<br>\u2022 Dollar Net: $+4,579,434.08<br><br><b>Visual Info:</b><br>\u2022 Node Size: 55.0px radius<br>\u2022 Represents: 37 total organizations", "org_total": 37}, {"id": "Cledara Limited", "label": "Cledara Limited", "color": "#96ceb4", "size": 25.0, "x": 515.6610855512324, "y": 661.9752649174104, "tooltip": "<b>Cledara Limited</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 13<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 13<br>\u2022 Org Net: -13<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $597,401.97<br>\u2022 Dollar Inflow: $100,479.25<br>\u2022 Dollar Outflow: $496,922.72<br>\u2022 Dollar Net: $-396,443.47<br><br><b>Visual Info:</b><br>\u2022 Node Size: 25.0px radius<br>\u2022 Represents: 13 total organizations", "org_total": 13}, {"id": "Order", "label": "Order", "color": "#95a5a6", "size": 20.0, "x": 885.7303727123674, "y": 330.1556734113011, "tooltip": "<b>Order</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 9<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 9<br>\u2022 Org Net: -9<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $3,279,299.62<br>\u2022 Dollar Inflow: $0.00<br>\u2022 Dollar Outflow: $3,279,299.62<br>\u2022 Dollar Net: $-3,279,299.62<br><br><b>Visual Info:</b><br>\u2022 Node Size: 20.0px radius<br>\u2022 Represents: 9 total organizations", "org_total": 9}, {"id": "Flychain", "label": "Flychain", "color": "#feca57", "size": 16.25, "x": 264.07249949201577, "y": 240.73006931617599, "tooltip": "<b>Flychain</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 6<br>\u2022 Org Inflow: 1<br>\u2022 Org Outflow: 5<br>\u2022 Org Net: -4<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $26,775.34<br>\u2022 Dollar Inflow: $100.34<br>\u2022 Dollar Outflow: $26,675.00<br>\u2022 Dollar Net: $-26,574.66<br><br><b>Visual Info:</b><br>\u2022 Node Size: 16.2px radius<br>\u2022 Represents: 6 total organizations", "org_total": 6}, {"id": "Upflow", "label": "Upflow", "color": "#ff6348", "size": 11.25, "x": 228.83057817807367, "y": 406.18672260668905, "tooltip": "<b>Upflow</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 2<br>\u2022 Org Inflow: 1<br>\u2022 Org Outflow: 1<br>\u2022 Org Net: +0<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $584.03<br>\u2022 Dollar Inflow: $37.37<br>\u2022 Dollar Outflow: $546.66<br>\u2022 Dollar Net: $-509.29<br><br><b>Visual Info:</b><br>\u2022 Node Size: 11.2px radius<br>\u2022 Represents: 2 total organizations", "org_total": 2}, {"id": "Hostfi Inc. DBA Accountable", "label": "Hostfi Inc. DBA...", "color": "#ff9ff3", "size": 10.0, "x": 568.8300978042548, "y": 100.0, "tooltip": "<b>Hostfi Inc. DBA Accountable</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 1<br>\u2022 Org Inflow: 1<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +1<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $417.32<br>\u2022 Dollar Inflow: $417.32<br>\u2022 Dollar Outflow: $0.00<br>\u2022 Dollar Net: $+417.32<br><br><b>Visual Info:</b><br>\u2022 Node Size: 10.0px radius<br>\u2022 Represents: 1 total organizations", "org_total": 1}, {"id": "BRKR.IO Inc.", "label": "BRKR.IO Inc.", "color": "#00d2d3", "size": 10.0, "x": 811.1897869462412, "y": 127.79343500062504, "tooltip": "<b>BRKR.IO Inc.</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 1<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 1<br>\u2022 Org Net: -1<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $5,435.71<br>\u2022 Dollar Inflow: $0.00<br>\u2022 Dollar Outflow: $5,435.71<br>\u2022 Dollar Net: $-5,435.71<br><br><b>Visual Info:</b><br>\u2022 Node Size: 10.0px radius<br>\u2022 Represents: 1 total organizations", "org_total": 1}];
        const links = [{"source": "Koverly Inc.", "target": "Cargosprint", "orgs": 17}, {"source": "Koverly Inc.", "target": "Avalara Inc", "orgs": 5}, {"source": "Koverly Inc.", "target": "Relay Financial Technologies, Inc", "orgs": 3}, {"source": "Relay Financial Technologies, Inc", "target": "HouseCall Pro", "orgs": 13}, {"source": "Relay Financial Technologies, Inc", "target": "Avalara Inc", "orgs": 12}, {"source": "Relay Financial Technologies, Inc", "target": "Hostfi Inc. DBA Accountable", "orgs": 1}, {"source": "Relay Financial Technologies, Inc", "target": "Upflow", "orgs": 1}, {"source": "Relay Financial Technologies, Inc", "target": "Flychain", "orgs": 1}, {"source": "Avalara Inc", "target": "HouseCall Pro", "orgs": 2}, {"source": "Avalara Inc", "target": "Relay Financial Technologies, Inc", "orgs": 1}, {"source": "Cledara Limited", "target": "Avalara Inc", "orgs": 10}, {"source": "Cledara Limited", "target": "Relay Financial Technologies, Inc", "orgs": 3}, {"source": "Order", "target": "Avalara Inc", "orgs": 5}, {"source": "Order", "target": "HouseCall Pro", "orgs": 2}, {"source": "Order", "target": "Relay Financial Technologies, Inc", "orgs": 2}, {"source": "Flychain", "target": "Relay Financial Technologies, Inc", "orgs": 4}, {"source": "Flychain", "target": "HouseCall Pro", "orgs": 1}, {"source": "Upflow", "target": "Avalara Inc", "orgs": 1}, {"source": "BRKR.IO Inc.", "target": "Avalara Inc", "orgs": 1}];

        // Create force simulation
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(150))
            .force("charge", d3.forceManyBody().strength(-1000))
            .force("center", d3.forceCenter(width / 2, height / 2));

        // Create links with proper bidirectional handling
        const link = svg.append("g")
            .selectAll("line")
            .data(links)
            .enter().append("line")
            .attr("class", "link")
            .attr("stroke-width", d => Math.max(2, d.orgs / 50))
            .attr("marker-end", "url(#end)");

        // Create edge labels with proper positioning for bidirectional links
        const edgeLabels = svg.append("g")
            .selectAll("text")
            .data(links)
            .enter().append("text")
            .attr("class", "edge-label")
            .style("fill", "red")
            .style("font-weight", "bold")
            .style("font-size", "10px")
            .text(d => d.orgs);

        // Create nodes
        const node = svg.append("g")
            .selectAll("circle")
            .data(nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", d => d.size)
            .attr("fill", d => d.color)
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // Create node labels
        const nodeLabels = svg.append("g")
            .selectAll("text")
            .data(nodes)
            .enter().append("text")
            .attr("class", "node-label")
            .style("fill", "black")
            .style("font-weight", "bold")
            .text(d => d.label);

        // Tooltip
        const tooltip = d3.select(".tooltip");

        // Add hover events
        node.on("mouseover", function(event, d) {
            tooltip.transition().duration(200).style("opacity", .9);
            tooltip.html(d.tooltip)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", function(d) {
            tooltip.transition().duration(500).style("opacity", 0);
        });

        // Update positions on tick
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            edgeLabels
                .attr("x", d => {
                    const midX = (d.source.x + d.target.x) / 2;
                    if (d.bidirectional) {
                        const offset = d.direction === 'forward' ? 10 : -10;
                        const angle = Math.atan2(d.target.y - d.source.y, d.target.x - d.source.x);
                        return midX + offset * Math.cos(angle + Math.PI/2);
                    }
                    return midX;
                })
                .attr("y", d => {
                    const midY = (d.source.y + d.target.y) / 2;
                    if (d.bidirectional) {
                        const offset = d.direction === 'forward' ? 10 : -10;
                        const angle = Math.atan2(d.target.y - d.source.y, d.target.x - d.source.x);
                        return midY + offset * Math.sin(angle + Math.PI/2);
                    }
                    return midY;
                });

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);

            nodeLabels
                .attr("x", d => d.x)
                .attr("y", d => d.y + 5);
        });

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    </script>
</body>
</html>
