
<!DOCTYPE html>
<html>
<head>
    <title>Interactive Transaction Network</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .node {
            cursor: move;
            stroke: #fff;
            stroke-width: 2px;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            marker-end: url(#end);
        }
        .node-label {
            pointer-events: none;
            text-anchor: middle;
            font-size: 12px;
            font-weight: bold;
            fill: white;
        }
        .edge-label {
            pointer-events: none;
            text-anchor: middle;
            font-size: 12px;
            font-weight: bold;
            fill: red;
        }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <h2>OatFi Connected Partners Graph</h2>
    <svg width="1200" height="800"></svg>
    <div class="tooltip" style="opacity: 0;"></div>

    <script>
        const svg = d3.select("svg");
        const width = +svg.attr("width");
        const height = +svg.attr("height");

        // Add arrow markers for both directions
        const defs = svg.append("defs");
        
        defs.append("marker")
            .attr("id", "end")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 25)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#999");
            
        defs.append("marker")
            .attr("id", "start")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", -15)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M10,-5L0,0L10,5")
            .attr("fill", "#999");

        // Data
        const nodes = [{"id": "Relay Financial Technologies, Inc", "label": "Relay Financial...", "color": "#ff6b6b", "size": 51.58878504672897, "x": 775.9184497525009, "y": 532.0556169316998, "tooltip": "<b>Relay Financial Technologies, Inc</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 90<br>\u2022 Org Inflow: 13<br>\u2022 Org Outflow: 77<br>\u2022 Org Net: -64<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $2,261,277.85<br>\u2022 Dollar Inflow: $1,513,372.32<br>\u2022 Dollar Outflow: $747,905.53<br>\u2022 Dollar Net: $+765,466.79<br><br><b>Visual Info:</b><br>\u2022 Node Size: 51.6px radius<br>\u2022 Represents: 90 total organizations", "org_total": 90}, {"id": "Melio", "label": "Melio", "color": "#785cb8", "size": 60.0, "x": 919.8082260399833, "y": 411.5077103566348, "tooltip": "<b>Melio</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 108<br>\u2022 Org Inflow: 108<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +108<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $2,443,588.80<br>\u2022 Dollar Inflow: $727,833.11<br>\u2022 Dollar Outflow: $1,715,755.69<br>\u2022 Dollar Net: $-987,922.58<br><br><b>Visual Info:</b><br>\u2022 Node Size: 60.0px radius<br>\u2022 Represents: 108 total organizations", "org_total": 108}, {"id": "Koverly Inc.", "label": "Koverly Inc.", "color": "#45b7d1", "size": 40.8411214953271, "x": 597.442174463951, "y": 397.9778678506055, "tooltip": "<b>Koverly Inc.</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 67<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 67<br>\u2022 Org Net: -67<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $3,975,507.69<br>\u2022 Dollar Inflow: $2,221,072.78<br>\u2022 Dollar Outflow: $1,754,434.91<br>\u2022 Dollar Net: $+466,637.87<br><br><b>Visual Info:</b><br>\u2022 Node Size: 40.8px radius<br>\u2022 Represents: 67 total organizations", "org_total": 67}, {"id": "Cargosprint", "label": "Cargosprint", "color": "#54a0ff", "size": 17.47663551401869, "x": 200.0, "y": 475.28151683396254, "tooltip": "<b>Cargosprint</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 17<br>\u2022 Org Inflow: 17<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +17<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $1,593,103.68<br>\u2022 Dollar Inflow: $786,617.95<br>\u2022 Dollar Outflow: $806,485.73<br>\u2022 Dollar Net: $-19,867.78<br><br><b>Visual Info:</b><br>\u2022 Node Size: 17.5px radius<br>\u2022 Represents: 17 total organizations", "org_total": 17}, {"id": "HouseCall Pro", "label": "HouseCall Pro", "color": "#a55eea", "size": 17.94392523364486, "x": 840.5494617273532, "y": 528.0419813814229, "tooltip": "<b>HouseCall Pro</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 18<br>\u2022 Org Inflow: 18<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +18<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $1,274,638.15<br>\u2022 Dollar Inflow: $128,289.12<br>\u2022 Dollar Outflow: $1,146,349.03<br>\u2022 Dollar Net: $-1,018,059.91<br><br><b>Visual Info:</b><br>\u2022 Node Size: 17.9px radius<br>\u2022 Represents: 18 total organizations", "org_total": 18}, {"id": "Avalara Inc", "label": "Avalara Inc", "color": "#4ecdc4", "size": 32.429906542056074, "x": 520.8625608151419, "y": 623.0324353030409, "tooltip": "<b>Avalara Inc</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 49<br>\u2022 Org Inflow: 34<br>\u2022 Org Outflow: 15<br>\u2022 Org Net: +19<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $4,784,980.73<br>\u2022 Dollar Inflow: $4,664,531.98<br>\u2022 Dollar Outflow: $120,448.75<br>\u2022 Dollar Net: $+4,544,083.23<br><br><b>Visual Info:</b><br>\u2022 Node Size: 32.4px radius<br>\u2022 Represents: 49 total organizations", "org_total": 49}, {"id": "Cledara Limited", "label": "Cledara Limited", "color": "#96ceb4", "size": 16.542056074766354, "x": 746.7972011512741, "y": 407.10461636860174, "tooltip": "<b>Cledara Limited</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 15<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 15<br>\u2022 Org Net: -15<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $616,433.76<br>\u2022 Dollar Inflow: $100,479.25<br>\u2022 Dollar Outflow: $515,954.51<br>\u2022 Dollar Net: $-415,475.26<br><br><b>Visual Info:</b><br>\u2022 Node Size: 16.5px radius<br>\u2022 Represents: 15 total organizations", "org_total": 15}, {"id": "Order", "label": "Order", "color": "#95a5a6", "size": 14.205607476635514, "x": 434.12667839337746, "y": 285.6271943163622, "tooltip": "<b>Order</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 10<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 10<br>\u2022 Org Net: -10<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $3,280,218.00<br>\u2022 Dollar Inflow: $0.00<br>\u2022 Dollar Outflow: $3,280,218.00<br>\u2022 Dollar Net: $-3,280,218.00<br><br><b>Visual Info:</b><br>\u2022 Node Size: 14.2px radius<br>\u2022 Represents: 10 total organizations", "org_total": 10}, {"id": "Flychain", "label": "Flychain", "color": "#feca57", "size": 13.271028037383177, "x": 572.3355214504195, "y": 585.6815945111202, "tooltip": "<b>Flychain</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 8<br>\u2022 Org Inflow: 1<br>\u2022 Org Outflow: 7<br>\u2022 Org Net: -6<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $49,319.32<br>\u2022 Dollar Inflow: $101.32<br>\u2022 Dollar Outflow: $49,218.00<br>\u2022 Dollar Net: $-49,116.68<br><br><b>Visual Info:</b><br>\u2022 Node Size: 13.3px radius<br>\u2022 Represents: 8 total organizations", "org_total": 8}, {"id": "BRKR.IO Inc.", "label": "BRKR.IO Inc.", "color": "#00d2d3", "size": 10.0, "x": 575.6120020378232, "y": 111.31496618606661, "tooltip": "<b>BRKR.IO Inc.</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 1<br>\u2022 Org Inflow: 0<br>\u2022 Org Outflow: 1<br>\u2022 Org Net: -1<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $5,435.71<br>\u2022 Dollar Inflow: $0.00<br>\u2022 Dollar Outflow: $5,435.71<br>\u2022 Dollar Net: $-5,435.71<br><br><b>Visual Info:</b><br>\u2022 Node Size: 10.0px radius<br>\u2022 Represents: 1 total organizations", "org_total": 1}, {"id": "Upflow", "label": "Upflow", "color": "#ff6348", "size": 10.467289719626168, "x": 785.4928737942732, "y": 137.32356667203663, "tooltip": "<b>Upflow</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 2<br>\u2022 Org Inflow: 1<br>\u2022 Org Outflow: 1<br>\u2022 Org Net: +0<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $584.03<br>\u2022 Dollar Inflow: $37.37<br>\u2022 Dollar Outflow: $546.66<br>\u2022 Dollar Net: $-509.29<br><br><b>Visual Info:</b><br>\u2022 Node Size: 10.5px radius<br>\u2022 Represents: 2 total organizations", "org_total": 2}, {"id": "Hostfi Inc. DBA Accountable", "label": "Hostfi Inc. DBA...", "color": "#ff9ff3", "size": 10.0, "x": 231.0548503739023, "y": 305.0509332884463, "tooltip": "<b>Hostfi Inc. DBA Accountable</b><br><br><b>Organization Metrics:</b><br>\u2022 Total Orgs: 1<br>\u2022 Org Inflow: 1<br>\u2022 Org Outflow: 0<br>\u2022 Org Net: +1<br><br><b>Dollar Metrics:</b><br>\u2022 Total Volume: $417.32<br>\u2022 Dollar Inflow: $417.32<br>\u2022 Dollar Outflow: $0.00<br>\u2022 Dollar Net: $+417.32<br><br><b>Visual Info:</b><br>\u2022 Node Size: 10.0px radius<br>\u2022 Represents: 1 total organizations", "org_total": 1}];
        const links = [{"source": "Relay Financial Technologies, Inc", "target": "Melio", "orgs": 49}, {"source": "Relay Financial Technologies, Inc", "target": "HouseCall Pro", "orgs": 13}, {"source": "Relay Financial Technologies, Inc", "target": "Avalara Inc", "orgs": 12}, {"source": "Relay Financial Technologies, Inc", "target": "Upflow", "orgs": 1}, {"source": "Relay Financial Technologies, Inc", "target": "Flychain", "orgs": 1}, {"source": "Relay Financial Technologies, Inc", "target": "Hostfi Inc. DBA Accountable", "orgs": 1}, {"source": "Koverly Inc.", "target": "Melio", "orgs": 42}, {"source": "Koverly Inc.", "target": "Cargosprint", "orgs": 17}, {"source": "Koverly Inc.", "target": "Avalara Inc", "orgs": 5}, {"source": "Koverly Inc.", "target": "Relay Financial Technologies, Inc", "orgs": 3}, {"source": "Avalara Inc", "target": "Melio", "orgs": 12}, {"source": "Avalara Inc", "target": "HouseCall Pro", "orgs": 2}, {"source": "Avalara Inc", "target": "Relay Financial Technologies, Inc", "orgs": 1}, {"source": "Cledara Limited", "target": "Avalara Inc", "orgs": 10}, {"source": "Cledara Limited", "target": "Relay Financial Technologies, Inc", "orgs": 3}, {"source": "Cledara Limited", "target": "Melio", "orgs": 2}, {"source": "Order", "target": "Avalara Inc", "orgs": 5}, {"source": "Order", "target": "HouseCall Pro", "orgs": 2}, {"source": "Order", "target": "Relay Financial Technologies, Inc", "orgs": 2}, {"source": "Order", "target": "Melio", "orgs": 1}, {"source": "Flychain", "target": "Relay Financial Technologies, Inc", "orgs": 4}, {"source": "Flychain", "target": "Melio", "orgs": 2}, {"source": "Flychain", "target": "HouseCall Pro", "orgs": 1}, {"source": "BRKR.IO Inc.", "target": "Avalara Inc", "orgs": 1}, {"source": "Upflow", "target": "Avalara Inc", "orgs": 1}];

        // Create force simulation
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(150))
            .force("charge", d3.forceManyBody().strength(-1000))
            .force("center", d3.forceCenter(width / 2, height / 2));

        // Create links with proper bidirectional handling
        const link = svg.append("g")
            .selectAll("line")
            .data(links)
            .enter().append("line")
            .attr("class", "link")
            .attr("stroke-width", d => Math.max(2, d.orgs / 50))
            .attr("marker-end", "url(#end)");

        // Create edge labels with proper positioning for bidirectional links
        const edgeLabels = svg.append("g")
            .selectAll("text")
            .data(links)
            .enter().append("text")
            .attr("class", "edge-label")
            .style("fill", "red")
            .style("font-weight", "bold")
            .style("font-size", "10px")
            .text(d => d.orgs);

        // Create nodes
        const node = svg.append("g")
            .selectAll("circle")
            .data(nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", d => d.size)
            .attr("fill", d => d.color)
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // Create node labels
        const nodeLabels = svg.append("g")
            .selectAll("text")
            .data(nodes)
            .enter().append("text")
            .attr("class", "node-label")
            .style("fill", "black")
            .style("font-weight", "bold")
            .text(d => d.label);

        // Tooltip
        const tooltip = d3.select(".tooltip");

        // Add hover events
        node.on("mouseover", function(event, d) {
            tooltip.transition().duration(200).style("opacity", .9);
            tooltip.html(d.tooltip)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", function(d) {
            tooltip.transition().duration(500).style("opacity", 0);
        });

        // Update positions on tick
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            edgeLabels
                .attr("x", d => {
                    const midX = (d.source.x + d.target.x) / 2;
                    if (d.bidirectional) {
                        const offset = d.direction === 'forward' ? 10 : -10;
                        const angle = Math.atan2(d.target.y - d.source.y, d.target.x - d.source.x);
                        return midX + offset * Math.cos(angle + Math.PI/2);
                    }
                    return midX;
                })
                .attr("y", d => {
                    const midY = (d.source.y + d.target.y) / 2;
                    if (d.bidirectional) {
                        const offset = d.direction === 'forward' ? 10 : -10;
                        const angle = Math.atan2(d.target.y - d.source.y, d.target.x - d.source.x);
                        return midY + offset * Math.sin(angle + Math.PI/2);
                    }
                    return midY;
                });

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);

            nodeLabels
                .attr("x", d => d.x)
                .attr("y", d => d.y + 5);
        });

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    </script>
</body>
</html>
